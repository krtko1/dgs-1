\NeedsTeXFormat{LaTeX2e}[2011/01/01]
\ProvidesPackage{dgs}[2016/11/10 Trojsten Document Generation System -- DeGeŠ]

% Document Generation System - skrátene DGS, čítaj DeGeŠ, chce nahradiť všetky existujúce
% spôsoby sádzania trojstenových zadaní, vzorákov a ostatných dokumentov.

% Prosíme o dodržiavanie nasledovných zásad.

% SI jednotky sa píšu pomocou balíčka siunitx. \SI{koľko}{čoho}. Žiadne \unit, \mathrm ani nič podobné.
% Ak ti stačí jednotka bez čísla, tak \si{jednotka}.
% Uhly sa takisto nepíšu ako v~roku 1997, ale používame makro \ang{90} alebo \ang{48;9;5}.
% Desatinné čísla sa dajú písať ako \num{4.7}, napríklad sa to automaticky
%   stará o slovenskú desatinnú čiarku miesto bodky.
% 


% NEVYMÝŠĽAJ VLASTNÉ HACKY, ŠPECIÁLNE NIE V PRÍPADE, ŽE TVOJ KÓD BUDE POUŽÍVAŤ AJ NIEKTO INÝ.
% Aj keď je TeX miestami nechutný, zatiaľ sa všetko podarilo spraviť +- čisto.

\RequirePackage[
    paper                   = a4paper,
    left                    = 15mm,
    right                   = 15mm,
    top                     = 15mm,
    bottom                  = 15mm,
    headheight              = 16pt,
    headsep                 = 16pt,
    footskip                = 32pt,
    includeheadfoot,                                        % započítať header a footer do rozmerov strany
    %showframe                                              % zobraziť frame
]{geometry}


\RequirePackage{
    amsmath,
    siunitx,
    xparse,
    enumitem,
    graphicx,
    listings,
    lastpage,
    marvosym,
    calc,
    pdftexcmds,
    xifthen,
    verbatim,
    color,
    float,
    caption,
    booktabs,
    titlesec,
    afterpage,
    pgffor,
    longtable,
    csvsimple,
    animate,
    skull,
    etoolbox,
    MnSymbol,
    fancyhdr,
    hyphenat,
    fancyvrb                                                % fancy verbatim (currently unused)
}

\captionsetup[figure]{
    format                  = hang,
    width                   = 0.9\textwidth,
}

\definecolor{colour-url}{RGB}{0, 137, 162}
\definecolor{colour-link}{RGB}{0, 137, 162}
\sisetup{
    separate-uncertainty    = true,                         % 7.2 ± 0.5
    detect-all              = true,                         % chceme zachovávať formátovanie prostredia
    multi-part-units        = single,                       % 12.3 ± 0.2 kg, neopakovať "kg"
    per-mode                = reciprocal,                   % symbol pre "m/s", reciprocal pre "ms^{-1}"
    group-separator         = {\,},
    group-minimum-digits    = 5,
    inter-unit-product      = {\kern 0.05em},               % veľmi tenká medzera medzi jednotkami
    exponent-product        = \cdot,                        % \times pre 5×10^7, \cdot pre 5.1O^7    
    number-unit-product     = {\,},                         % medzera medzi číslom a jednotkou
    output-decimal-marker   = {\text{,}},                   % v desatinných číslach chceme slovenskú čiarku
    range-units             = single,
    range-phrase            = {\text{--}},                  % 5 -- 10 m/s
    list-units              = single,                       %
    list-final-separator    = {\ a\ },                      % 5, 7 a 10 m/s
}

%
\RequirePackage[
    colorlinks              = true,
    linkcolor               = colour-link,                  % custom Trojsten link colour
    urlcolor                = colour-url,                   % custom Trojsten URL link colour
]{hyperref}

\RequirePackage[e]{esvect}                                  % nicer vector overset
\RequirePackage[all]{nowidow}

% Setup XeLaTeX-specific options

\RequirePackage{boolexpr}                                   % boolean expressions, switch
\RequirePackage{core/dgs-fonts}
\RequirePackage{core/dgs-hacks}
\RequirePackage{core/dgs-utils}

\NewDocumentCommand{\lang}{O{en} +m}{%
    \ifstrequals{#1}{\currentLanguage}{#2}{}%
}

\NewDocumentCommand{\loadDocumentSettings}{}{
    \IfFileExists{input/settings.tex}{
        \input{input/settings.tex}                   
    }{
        \PackageError{dgs}{Cannot load document settings}{File "input/settings.tex" does not exist}
    }

}

% Internal commands
\NewDocumentCommand{\loadSeminar}{m}{
    \IfFileExists{core/config/dgs-config-#1.sty}{
        \RequirePackage{core/config/dgs-config-#1}                   
    }{
        \PackageError{dgs}{Cannot load seminar #1}{File "dgs-config-#1.sty" does not exist}
    }
}

\NewDocumentCommand{\currentProblem}{}{%
    \padzero{00}{\arabic{problem}}%
}

% \insertPicture{filename}{extension}{(ignored)}{height}{caption}{label}
% Insert a picture, protected against nonexistent files
%   - meno súboru, hľadá v aktuálnom priečinku
%   - prípona súboru
%   - prípona súboru pre HTML (ignoruje sa)
%   - výška obrázka (napríklad v mm)
%   - popis pod obrázkom
%   - label pre odkázanie sa na obrázok
\NewDocumentCommand{\insertPicture}{m m m m m m}{%
    \begin{figure}[H]%
        \centering%
        \IfFileExists{\rootDirectory/\currentProblem/#1.#2}{%
            \includegraphics[keepaspectratio = true, height = #4]{\rootDirectory/\currentProblem/#1}%
        }{%
            \includegraphics[keepaspectratio = true, height = #4]{example-image-a}%
        }%
        \ifstrempty{#5}{}{\caption{\textit{#5}}}%
        \ifstrempty{#6}{}{\label{#6}}%
    \end{figure}%
}

% \exampleIO[verbatim input][verbatim output]
% Príklad vstupu/výstupu (KSP)
%   - verbatim vstup
%   ₋ verbatim výstup
% Používa ExplSyntax z LaTeX3
\ExplSyntaxOn
\char_set_catcode_other:n {`\^^M}
\NewDocumentCommand{\exampleIO}{+v +v}{
    \tl_set:Nn \l_tmpa_tl {#1}
    \tl_set:Nn \l_tmpb_tl {#2}
    \tl_replace_all:Nnn \l_tmpa_tl {^^M} {\par}
    \tl_replace_all:Nnn \l_tmpb_tl {^^M} {\par}
    
    \begin{minipage}[t]{0.48\linewidth}     
        \begin{center}vstup\end{center}
        \vspace{-15pt}                                              % one nasty hack here       
        \fbox{
            \begin{minipage}[t]{\linewidth}
                \mbox{}\\[-1.5\baselineskip]                        % another nasty hack here
                \ttfamily
                \l_tmpa_tl
            \end{minipage}
        }
    \end{minipage}
    
    \begin{minipage}[t]{0.0393\linewidth}
        \mbox{}
    \end{minipage}
    
    \begin{minipage}[t]{0.48\linewidth}
        \begin{center}výstup\end{center}
        \vspace{-15pt}                                              % guess what here
        \fbox{
            \begin{minipage}[t]{0.975\linewidth}
                \mbox{}\\[-1.5\baselineskip]                        % and one nasty hack here
                \ttfamily
                \l_tmpb_tl
            \end{minipage}
        }
    \end{minipage}
    \\[1ex]
}
\char_set_catcode_end_line:n{`\^^M}
\ExplSyntaxOff

\endinput                                                           % everything below is safely ignored


